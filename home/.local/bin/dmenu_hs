#!/usr/bin/env bash
HISTORY_PATH=~/.cache/dmenu
[ $# -ge 1 ] && FILE=$HISTORY_PATH/$1.hist || exit
touch $FILE

result=$(cat -)
[ "$result" == "" ] && echo "$result" && exit

timestamp=$(date "+%s")
if found=$(rg "[0-9]*: $result$" $FILE); then
	escaped=${result//\//\\/}
	sed -i "s/[0-9]*: $escaped/$timestamp: $escaped/g" $FILE
else
	echo "$timestamp: $result" >> $FILE
fi
sort -rn -o $FILE $FILE
echo $result
