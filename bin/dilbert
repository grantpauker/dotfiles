#!/usr/bin/env bash
get_comic_url(){
  curl -s "http://dilbert.com/strip/$1" | grep "img-responsive img-comic" | sed 's/.*src="\(.*\)".*/\1/g'
}

today=$(date "+%Y-%m-%d")
d=1989-04-16
if [[ "$1" == "-t" ]]; then
	echo "Getting from today ($today)..."
	url=$(get_comic_url $today)
	[[ "$url" == "" ]] && echo "ERROR on getting today" || wget --quiet -O ~/Documents/dilbert/$today.jpg $url	
	cp ~/Documents/dilbert/$today.jpg /tmp/dilbert-today.jpg
	exit
fi
while [ "$d" != "$today" ]; do 
  d=$(date "+%Y-%m-%d" -d "$d + 1 day")
	[[ -f ~/dilbert/$d.jpg ]] && echo "$d already downloaded, continuing" && continue
  echo "Getting from $d..."
	url=$(get_comic_url $d)
	[[ "$url" == "" ]] && echo "ERROR on $d" || wget --quiet -O ~/Documents/dilbert/$d.jpg $url
done
