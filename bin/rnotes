#!/usr/bin/env bash
NOTES_DIR=~/notes

new-note(){
	choice=$(printf "yes\nno\n" | rofi -dmenu -p "$1 does not exist, create it")
	[[ "$choice" == "yes" ]] && touch $NOTES_DIR/$1.md || exit
}
open-note(){
	echo $NOTE_NAME > $NOTES_DIR/.last
	termite --class="workfree" --name="rnotes" -e "nvim $NOTES_DIR/$NOTE_NAME.md" 
}

xdotool search --classname rnotes && exit
[[ "$1" == "last" && -f $NOTES_DIR/.last ]] && NOTE_NAME="$(cat $NOTES_DIR/.last)" && open-note && exit

NOTES_ALL=$(find $NOTES_DIR -type f -name \*.md -not -name ".*" -exec basename {} .md \;)
NOTE_NAME=$(echo "${NOTES_ALL[@]}" | rofi -dmenu -p "note")

[[ "$NOTE_NAME" == "" ]] && exit
[[ -f $NOTES_DIR/$NOTE_NAME.md ]] || new-note "$NOTE_NAME" 

open-note
